<!-- üå∫ Secci√≥n principal de personalizaci√≥n -->
<div class="bg-gradient-to-b from-red-50 via-pink-50 to-red-100 min-h-screen py-10">
  <div class="container mx-auto px-4">
    <h1 class="text-center text-4xl md:text-6xl font-artistic text-red-500 drop-shadow-md mb-6">
      Personaliza tu Mochila
    </h1>

    <p class="text-center font-artistic text-2xl mb-10 text-gray-700">
      Selecciona el <span class="text-red-500 font-bold">patr√≥n</span> que deseas para tu mochila:
    </p>

    <!-- üå∏ Patrones -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10 justify-items-center">
      <!-- Patr√≥n #1 -->
      <div
        class="relative flex w-80 flex-col rounded-3xl bg-white shadow-xl hover:shadow-2xl transition-all duration-300 border border-red-200 hover:scale-105">
        <div class="relative mx-4 -mt-6 h-44 overflow-hidden rounded-2xl shadow-lg">
          <img src="assets/patrones/patron1.png" alt="Patr√≥n 1"
            class="w-full h-full object-cover border-2 border-pink-400 rounded-2xl" />
        </div>
        <div class="p-6 text-center">
          <h5 class="font-ubuntu text-xl font-semibold text-gray-800 mb-3">Patr√≥n #1</h5>
          <button
            (click)="seleccionarPatron(opciones[0])"
            [ngClass]="patronSeleccionado === opciones[0]
              ? 'bg-green-500 shadow-green-500/30 hover:shadow-green-500/50'
              : 'bg-red-400 shadow-red-400/20 hover:shadow-red-400/40'"
            class="select-none rounded-lg py-3 px-6 text-center font-ubuntu text-sm font-bold uppercase text-white shadow-md transition-all">
            {{ patronSeleccionado === opciones[0] ? 'Seleccionado' : 'Seleccionar' }}
          </button>
        </div>
      </div>

      <!-- Patr√≥n #2 -->
      <div
        class="relative flex w-80 flex-col rounded-3xl bg-white shadow-xl hover:shadow-2xl transition-all duration-300 border border-red-200 hover:scale-105">
        <div class="relative mx-4 -mt-6 h-44 overflow-hidden rounded-2xl shadow-lg">
          <img src="assets/patrones/patron2.png" alt="Patr√≥n 2"
            class="w-full h-full object-cover border-2 border-violet-400 rounded-2xl" />
        </div>
        <div class="p-6 text-center">
          <h5 class="font-ubuntu text-xl font-semibold text-gray-800 mb-3">Patr√≥n #2</h5>
          <button
            (click)="seleccionarPatron(opciones[1])"
            [ngClass]="patronSeleccionado === opciones[1]
              ? 'bg-green-500 shadow-green-500/30 hover:shadow-green-500/50'
              : 'bg-red-400 shadow-red-400/20 hover:shadow-red-400/40'"
            class="select-none rounded-lg py-3 px-6 text-center font-ubuntu text-sm font-bold uppercase text-white shadow-md transition-all">
            {{ patronSeleccionado === opciones[1] ? 'Seleccionado' : 'Seleccionar' }}
          </button>
        </div>
      </div>

      <!-- Patr√≥n #3 -->
      <div
        class="relative flex w-80 flex-col rounded-3xl bg-white shadow-xl hover:shadow-2xl transition-all duration-300 border border-red-200 hover:scale-105">
        <div class="relative mx-4 -mt-6 h-44 overflow-hidden rounded-2xl shadow-lg">
          <img src="assets/patrones/patron3.png" alt="Patr√≥n 3"
            class="w-full h-full object-cover border-2 border-red-400 rounded-2xl" />
        </div>
        <div class="p-6 text-center">
          <h5 class="font-ubuntu text-xl font-semibold text-gray-800 mb-3">Patr√≥n #3</h5>
          <button
            (click)="seleccionarPatron(opciones[2])"
            [ngClass]="patronSeleccionado === opciones[2]
              ? 'bg-green-500 shadow-green-500/30 hover:shadow-green-500/50'
              : 'bg-red-400 shadow-red-400/20 hover:shadow-red-400/40'"
            class="select-none rounded-lg py-3 px-6 text-center font-ubuntu text-sm font-bold uppercase text-white shadow-md transition-all">
            {{ patronSeleccionado === opciones[2] ? 'Seleccionado' : 'Seleccionar' }}
          </button>
        </div>
      </div>
    </div>

    <!-- üé® Colores -->
    <div *ngIf="patronSeleccionado" #coloresSection class="mt-16">
      <hr class="border-red-200 mb-8">
      <p class="text-center font-artistic text-2xl mb-10 text-gray-700">
        Selecciona el <span class="text-red-500 font-bold">color</span> que deseas para tu mochila:
      </p>

      <div class="flex flex-wrap justify-center gap-5">
        <button *ngFor="let color of patronSeleccionado?.colores"
          (click)="seleccionarColor(color)"
          [ngStyle]="{'background-color': color.toLowerCase()}"
          [ngClass]="colorSeleccionado === color ? 'ring-4 ring-green-400 scale-110' : 'ring-2 ring-gray-300'"
          class="w-14 h-14 rounded-full shadow-md transition-all duration-300 hover:scale-110">
        </button>
      </div>
    </div>

    <!-- üìè Tama√±os -->
    <div *ngIf="colorSeleccionado" #tamaniosSection class="mt-16">
      <hr class="border-red-200 mb-8">
      <p class="text-center font-artistic text-2xl mb-10 text-gray-700">
        Selecciona el <span class="text-red-500 font-bold">tama√±o</span> que deseas:
      </p>

      <div class="flex flex-wrap justify-center gap-5">
        <button *ngFor="let precio of patronSeleccionado?.precios"
          (click)="seleccionarMedida(precio.tamano)"
          [ngClass]="tamSeleccionado === precio.tamano
            ? 'bg-green-500 text-white shadow-green-500/30 hover:shadow-green-500/50'
            : 'bg-gray-100 text-gray-800 hover:bg-gray-200'"
          class="px-6 py-3 rounded-xl font-ubuntu font-semibold shadow-md transition-all duration-300">
          {{ precio.tamano }} <br>
          <small class="text-sm font-normal">{{ precio.cop | currency:'COP':'symbol-narrow':'1.0' }}</small>
        </button>
      </div>

      <div *ngIf="tamSeleccionado" class="text-center mt-6">
        <p class="text-lg font-semibold text-gray-700">
          üí∞ Precio: <span class="text-green-600">{{ costoMochila | currency:'COP' }}</span>
          ({{ costoMochilaUSD }} USD)
        </p>
      </div>
    </div>

    <!-- üñºÔ∏è Preview -->
    <div *ngIf="tamSeleccionado" #previewSection class="mt-16 mb-10">
      <hr class="border-red-200 mb-8">
      <p class="text-center font-artistic text-2xl mb-10 text-gray-700 font-bold">
        Imagen previa del dise√±o seleccionado:
      </p>

      <div *ngIf="imagenPreview" class="flex justify-center my-8">
        <img [src]="imagenPreview" alt="Vista previa de mochila"
          class="w-64 h-64 object-cover rounded-3xl shadow-2xl border-4 border-white ring-2 ring-red-200">
      </div>

      <button (click)="abrirModal()"
        class="flex items-center justify-center gap-3 mx-auto bg-green-500 hover:bg-green-600 text-white font-ubuntu font-bold px-6 py-3 rounded-lg shadow-lg transition-all duration-300">
        <i class="fab fa-whatsapp text-xl"></i>
        Realizar pedido
      </button>
    </div>
  </div>
</div>


<!-- üåà Modal personalizado -->
<div *ngIf="mostrarModal" class="fixed inset-0 flex items-center justify-center bg-black/40 backdrop-blur-sm z-50">
  <div class="bg-gradient-to-br from-white via-red-50 to-pink-100 rounded-3xl shadow-2xl w-11/12 max-w-5xl my-10 p-8 relative max-h-[95vh] overflow-y-auto animate-fadeIn">
    
    <!-- Bot√≥n cerrar -->
    <button (click)="cerrarModal()"
      class="absolute top-4 right-4 bg-white text-gray-700 hover:bg-red-100 hover:text-red-500 w-10 h-10 flex items-center justify-center rounded-full shadow-md transition-all duration-300">
      ‚úï
    </button>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
      <!-- Imagen -->
      <div class="flex flex-col items-center justify-center gap-5">
        <div class="relative">
          <img [src]="imagenPreview" alt="Mochila seleccionada" class="w-64 h-64 rounded-2xl shadow-xl object-cover border-4 border-white" />
          <div class="absolute inset-0 rounded-2xl ring-4 ring-pink-300/50 animate-pulse"></div>
        </div>

        <a [href]="imagenPreview" download="mochila-disenada.png"
          class="bg-blue-500 hover:bg-blue-600 text-white text-sm font-semibold px-6 py-2 rounded-lg shadow-md transition-all hover:scale-105">
          <i class="fa-solid fa-download mr-1"></i> Descargar dise√±o
        </a>

        <p class="text-center text-gray-600 text-sm font-ubuntu px-4">
          Descargue el dise√±o para adjuntarlo al pedido en WhatsApp.
        </p>
      </div>

      <!-- Detalles -->
      <div>
        <h2 class="text-3xl font-artistic text-red-400 mb-6 text-center drop-shadow-md">üßµ Detalles del pedido</h2>

        <ul class="text-gray-700 mb-6 font-ubuntu bg-white/70 rounded-xl p-4 shadow-sm space-y-1">
          <li><span class="font-bold text-red-500">Patr√≥n:</span> {{patronSeleccionado?.patron}}</li>
          <li><span class="font-bold text-red-500">Color:</span> {{colorSeleccionado}}</li>
          <li><span class="font-bold text-red-500">Tama√±o:</span> {{tamSeleccionado}}</li>
          <li><span class="font-bold text-red-500">Costo:</span> {{costoMochila | currency:'COP ':'symbol':'1.0-0'}} ({{costoMochilaUSD}} USD)</li>
        </ul>

        <form #formPedido="ngForm" class="space-y-3 font-ubuntu">
          <input type="text" [(ngModel)]="datosUsuario.nombre" name="nombre" placeholder="Nombre completo" required
            class="w-full px-4 py-2 border-2 border-transparent rounded-lg focus:ring-2 focus:ring-red-300 focus:border-red-400 transition-all" />

          <input type="tel" [(ngModel)]="datosUsuario.telefono" name="telefono" placeholder="Tel√©fono" required
            class="w-full px-4 py-2 border-2 border-transparent rounded-lg focus:ring-2 focus:ring-red-300 focus:border-red-400 transition-all" />

          <input type="text" [(ngModel)]="datosUsuario.direccion" name="direccion" placeholder="Direcci√≥n" required
            class="w-full px-4 py-2 border-2 border-transparent rounded-lg focus:ring-2 focus:ring-red-300 focus:border-red-400 transition-all" />

          <div class="grid grid-cols-2 gap-3">
            <input type="text" [(ngModel)]="datosUsuario.ciudad" name="ciudad" placeholder="Ciudad" required
              class="px-4 py-2 border-2 border-transparent rounded-lg focus:ring-2 focus:ring-red-300 focus:border-red-400 transition-all" />

            <input type="text" [(ngModel)]="datosUsuario.departamento" name="departamento" placeholder="Departamento" required
              class="px-4 py-2 border-2 border-transparent rounded-lg focus:ring-2 focus:ring-red-300 focus:border-red-400 transition-all" />
          </div>

          <input type="text" [(ngModel)]="datosUsuario.pais" name="pais" placeholder="Pa√≠s" required
            class="w-full px-4 py-2 border-2 border-transparent rounded-lg focus:ring-2 focus:ring-red-300 focus:border-red-400 transition-all" />
        </form>

        <div class="mt-6 flex flex-col md:flex-row justify-between items-center gap-4">
          <button (click)="enviarPedidoWhatsApp(formPedido)" [disabled]="!formPedido.valid"
            class="flex items-center justify-center gap-2 bg-green-500 hover:bg-green-600 text-white font-bold px-6 py-3 rounded-lg shadow-md transition-all hover:scale-105 disabled:opacity-50 w-full md:w-auto">
            <i class="fab fa-whatsapp text-xl"></i> Confirmar y Enviar
          </button>

          <div id="paypal-button-container" class="w-full md:w-auto"></div>
        </div>
      </div>
    </div>
  </div>
</div>
